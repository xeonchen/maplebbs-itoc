§@ªÌ: itoc (cygreadline4.dll) ¯¸¤º: plan
¼ÐÃD: [¥\¯à] Áp¦Òº]³æ¬d¸ß
®É¶¡: 2004/05/21 Fri 09:16:41                           Updated: 2005/08/09

: etc/jcee

  §ì http://cpu.twbbs.org/~itoc/download/jcee/jcee.tgz ¸ÑÀ£ÁY¦b etc/ ¤U
  ¤]´N¬O­n¦³ etc/jcee/##.txt¡A## ¬O¥Á°ê¦~

: menu.c ¦b¾A·íªº¿ï³æ¥[¤W

+ "bin/jcee.so:main_jcee", 0, - M_XMODE,
+ "JCEE       ¡ñ Áp¦Ò¬dº] ¡ð",

: game/Makefile

SO =    ... [1;33mjcee.so[m

: game/jcee.c ·s¼W¦¹µ{¦¡

/*-------------------------------------------------------*/
/* jcee.c       ( NTU FPG BBS Ver 2.00 )                 */
/*-------------------------------------------------------*/
/* target : Áp¦Òº]³æ¬d¸ß                                 */
/* create : 98/08/08                                     */
/* update : 01/08/21                                     */
/* author : §d²Ð­l                                       */
/* modify : itoc.bbs@bbs.tnfsh.tn.edu.tw                 */
/*-------------------------------------------------------*/


#if 0

 ¸ê®Æ¨Ó·½
 http://www.csie.nctu.edu.tw/service/jcee/¾ú¦~

#endif


#include "bbs.h"


#define END_YEAR   94      /* ³Ì«á¤@¦~ªºº]³æ¬O¥Á°ê 94 ¦~ */


static int
ueequery_item(count, i, examnum, ptr, now)
  int count, i, examnum;
  char *now, *ptr;
{
  char buf[32];

  if (count > XO_TALL && (count % XO_TALL) == 1)
  {
    move(1, 0);
    clrtoeol();
    outs("\033[1;33m¥»­¶¬d¸ß¤wº¡¡A´«­¶¬d¸ß½Ð«ö¥ô·NÁä¡Aµ²§ô¬d¸ß½Ð«ö Q\033[m");

    if (vkey() == 'q')
      return 0;

    i = 0;
    vs_bar("Áp¦Òº]³æ¬d¸ß");
    move(2, 0);
    outs(COLOR2 " ­ã¦ÒÃÒ   ©m  ¦W    ¿ý ¨ú ¤j ¾Ç         "
      "¿ý ¨ú ¬ì ¨t                           \033[m");
  }

  move(3 + i, 0);

  sprintf(buf, " %%-%d.%ds%%%ds   %%-8s  %%s", examnum, examnum, 9 - examnum);
  prints(buf, ptr, "", ptr + examnum, now);

#if 0
  if (examnum == 6)
    prints(" %-6.6s   %-8s  %s", ptr, ptr + examnum, now);
  else if (examnum == 7)
    prints(" %-7.7s  %-8s  %s", ptr, ptr + examnum, now);
  else if (examnum == 8)
    prints(" %-8.8s %-8s  %s", ptr, ptr + examnum, now);
#endif

  move(b_lines, 0);
  clrtoeol();
  prints(COLOR1 " º]³æ¬d¸ß " COLOR2 " ¥Ø«e¦@¬d¸ß¨ì %4d µ§¸ê®Æ¡C"
    "¥»¸ê®Æ¶È¨Ñ°Ñ¦Ò¡A¿ý¨úµ²ªG¥HÁp©Û·|¤½¥¬¬°·Ç \033[m", count);

  return i + 1;
}


static void
ueequery_foot(count)
  int count;
{
  if (count == 0)
  {
    move(4, 0);
    outs("¨S¦³¬d¸ß¨ì¥ô¦ó¸ê®Æ");
  }
  move(b_lines, 0);
  clrtoeol();
  prints(COLOR1 " º]³æ¬d¸ß " COLOR2 " ¥Ø«e¦@¬d¸ß¨ì %4d µ§¸ê®Æ¡C"
    "¬d¸ßµ²§ô¡A«ö¥ô·NÁäÂ÷¶}                   \033[m", count);
  vkey();
}


static int
x_ueequery()
{
  char buf[256], query[20], now[80], *ptr;
  int i, count, year, examnum;
  FILE *fp;

  vs_bar("Áp¦Òº]³æ¬d¸ß");

  outs("\nª`·N¨Æ¶µ\n"
    "1. §¹¾ã­ã¦ÒÃÒ¸¹½X¤Î³¡¥÷©m¦W¨â¶µ¦Ü¤Ö»Ý¶ñ¼g¤@¶µ¤~¯à°÷¬d¸ß\n"
    "2. ­Y©m¦W¥u¦³¨â¦r¡A½Ð©ó¨â¦r¤¤¶¡¥[¥þ§ÎªÅ¥Õ\n"
    "3. 83-86 ¦~»Ý­n¤»¦ì­ã¦ÒÃÒ¸¹½X¡A87-90 ¦~»Ý­n¤C¦ì­ã¦ÒÃÒ¸¹½X\n"
    "4. 91¦~°_»Ý­n¤K¦ì­ã¦ÒÃÒ¸¹½X\n");

  sprintf(buf, "½Ð¿é¤JÁp¦Ò¦~«×(83 ~ %d)¡H[%d] ", END_YEAR, END_YEAR);

  if (!vget(9, 0, buf, query, 3, DOECHO))
  {
    year = END_YEAR;
  }
  else
  {
    year = atoi(query);
    if (year < 83 || year > END_YEAR)
      return 0;
  }

  if (year <= 86)
    examnum = 6;
  else if (year <= 90)
    examnum = 7;
  else
    examnum = 8;

  if (vget(11, 0, "½Ð¿é¤J§¹¾ã­ã¦ÒÃÒ¸¹½X¡G", query, examnum + 1, DOECHO))
  {
    if (strlen(query) != examnum)
    {
      vmsg("¤£¥¿½Tªº§¹¾ã­ã¦ÒÃÒ¸¹½X");
      return 0;
    }
  }
  else if (!vget(13, 0, "½Ð¿é¤J³¡¥÷©m¦W¡G", query, 10, DOECHO))
  {
    vmsg("½Ð©ó­ã¦ÒÃÒ¸¹½X©ó©m¦W¤GÄæ¤¤¾Ü¤@¶ñ¼g");
    return 0;
  }

  sprintf(buf, "etc/jcee/%d.txt", year);

  if (fp = fopen(buf, "r"))
  {
    int j;
    char *pquery;

    count = 0;  /* ºâ¥þ³¡¦³´X­Ó */
    i = 0;      /* ºâ¥»­¶ªº²Ä´X­Ó */

    vs_bar("Áp¦Òº]³æ¬d¸ß");
    prints("¬d¸ß¡m%s¡n¤¤....\n", query);
    outs(COLOR2 " ­ã¦ÒÃÒ   ©m  ¦W    ¿ý ¨ú ¤j ¾Ç         "
      "¿ý ¨ú ¬ì ¨t                           \033[m");

    while (fgets(buf, 256, fp))
    {
      if (buf[0] == ' ')        /* ³o¼Ë´N¬O¬ì¨tªº¶}ÀY */
      {
        ptr = strtok(buf + 5, " ");
        strcpy(now, ptr);
        ptr = strtok(NULL, " ");
        sprintf(now, "%-24s%-30s", now, ptr);
        continue;
      }

      ptr = strtok(buf, "    ");

      do
      {
        if (pquery = strstr(ptr, query))
          j = (pquery - ptr) + examnum + 1;
        else
          j = 2;               /* ªí¥Ü¥¼§ä¨ì */

        if (j == (pquery - ptr) + examnum + 1 || j % 2)/* ³B²z¤¤¤å¦rªº°ÝÃD */
        {
          count++;
          if (!(i = ueequery_item(count, i, examnum, ptr, now)))
          {
            fclose(fp);
            ueequery_foot(count);
            return 0;
          }
        }
      } while (ptr = strtok(NULL, "    "));
    }
    fclose(fp);
  }

  ueequery_foot(count);
  return 0;
}


static int
x_ueequery2()
{
  char buf[256], query[30], query2[30], now[80], *ptr;
  int i, count, year, examnum;
  int school, dept;
  FILE *fp;

  vs_bar("Áp¦Òº]³æ¬d¸ß");

  outs("\nª`·N¨Æ¶µ\n"
    "1. ¤j¾Ç¤Î¬ì¨t¨â¶µ¦Ü¤Ö»Ý¶ñ¼g¤@¶µ¤~¯à°÷¬d¸ß\n"
    "2. ¿é¤J³¡¤À¦r¦ê§Y¥i\n");

  sprintf(buf, "½Ð¿é¤JÁp¦Ò¦~«×(83 ~ %d)¡H[%d] ", END_YEAR, END_YEAR);

  if (!vget(9, 0, buf, query, 3, DOECHO))
  {
    year = END_YEAR;
  }
  else
  {
    year = atoi(query);
    if (year < 83 || year > END_YEAR)
      return 0;
  }

  if (year <= 86)
    examnum = 6;
  else if (year <= 90)
    examnum = 7;
  else
    examnum = 8;

  vget(11, 0, "½Ð¿é¤J¬d¸ß¤j¾Ç¡G", query, 20, DOECHO);
  vget(13, 0, "½Ð¿é¤J¬d¸ß¬ì¨t¡G", query2, 20, DOECHO);

  if (!*query && !*query2)
    return 0;

  sprintf(buf, "etc/jcee/%d.txt", year);

  if (fp = fopen(buf, "r"))
  {
    count = 0;  /* ºâ¥þ³¡¦³´X­Ó */
    i = 0;      /* ºâ¥»­¶ªº²Ä´X­Ó */

    vs_bar("Áp¦Òº]³æ¬d¸ß");
    prints("¬d¸ß¡m%s%s¡n¤¤....\n", query, query2);
    outs(COLOR2 " ­ã¦ÒÃÒ   ©m  ¦W    ¿ý ¨ú ¤j ¾Ç         "
      "¿ý ¨ú ¬ì ¨t                           \033[m");

    while (fgets(buf, 256, fp))
    {
      if (buf[0] == ' ')         /* ³o¼Ë´N¬O¬ì¨tªº¶}ÀY */
      {
        ptr = strtok(buf + 5, " ");
        strcpy(now, ptr);

        if (!*query || strstr(now, query))      /* §ä¨ì¾Ç®Õ */
          school = 1;
        else
          school = 0;

        ptr = strtok(NULL, " ");
        if (!*query2 || strstr(ptr, query2))    /* §ä¨ì¬ì¨t */
          dept = 1;
        else
          dept = 0;

        sprintf(now, "%-24s%-30s", now, ptr);
        continue;
      }

      ptr = strtok(buf, "    ");

      do
      {
        if (school && dept && strlen(ptr) >= 6)/* ³B²z¤¤¤å¦rªº°ÝÃD */
        {
          count++;
          if (!(i = ueequery_item(count, i, examnum, ptr, now)))
          {
            fclose(fp);
            ueequery_foot(count);
            return 0;
          }
        }
      } while (ptr = strtok(NULL, "    "));
    }

    fclose(fp);
  }

  ueequery_foot(count);
  return 0;
}


int
main_jcee()
{
  int ch;

  ch = vans("Áp¦Òº]³æ¬d¸ß¡A½Ð¿ï¾Ü 1)ª÷º]¬d¸ß 2)¬ì¨t¿ý¨ú¦W³æ [Q]Â÷¶} ");
  if (ch == '1')
    x_ueequery();
  else if (ch == '2')
    x_ueequery2();
  else
    return XEASY;

  return 0;
}

--
[1;37m¡¼ ¥»¤å³¹¥Ñ [33mitoc[37m ±q [32mitoc.Dorm11.NCTU.edu.tw[37m µoªí[m
